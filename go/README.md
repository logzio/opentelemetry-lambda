# OpenTelemetry Lambda Go

Examples of Go applications on AWS Lambda with OpenTelemetry.

## Provided SDK

[OpenTelemetry Lambda SDK for Go](https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/github.com/aws/aws-lambda-go/otellambda) includes tracing APIs to instrument Lambda handler.
For other instrumentations, such as http, you'll need to include the corresponding library instrumentation from the [instrumentation project](https://github.com/open-telemetry/opentelemetry-go) and modify your code to use it in your function.

## Provided Layer

[OpenTelemetry Lambda Layer for Collector](https://aws-otel.github.io/docs/getting-started/lambda/lambda-go#lambda-layer) includes OpenTelemetry Collector for Lambda components. Follow [user guide](https://aws-otel.github.io/docs/getting-started/lambda/lambda-go#enable-tracing) to apply this layer to your Lambda handler that's already been instrumented with OpenTelemetry Lambda .NET SDK to enable end-to-end tracing.

## Combined OpenTelemetry Lambda Layer

**New**: We now offer a simplified deployment option with a combined layer that includes the OpenTelemetry Collector. Since Go uses manual instrumentation, this layer provides the collector component to work with your manually instrumented Go Lambda functions.

### What's included in the combined layer:
- **OpenTelemetry Collector** - Built-in collector that exports telemetry data from your manually instrumented Go function to your configured backend
- **Optimized for Go** - Lightweight layer that complements manual instrumentation in Go applications
- **Configuration files** - Pre-configured collector settings optimized for Lambda environments

### Benefits:
- **Single layer deployment** - Just add the collector layer to your manually instrumented Go function
- **Simplified configuration** - Pre-configured for optimal Lambda performance
- **Production-ready** - Battle-tested collector configuration for serverless environments

### Usage:
Unlike other languages, Go requires manual instrumentation using the [OpenTelemetry Go SDK](https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/github.com/aws/aws-lambda-go/otellambda). The combined layer provides the collector component to export the telemetry data generated by your instrumented code.

To use:
1. Manually instrument your Go Lambda function using the OpenTelemetry Go SDK
2. Add the combined layer to your Lambda function
3. Configure the collector endpoint in your Go code to send telemetry to the local collector

For detailed build instructions, see the build script at `go/build-combined.sh` in this repository.

### Environment variables

Required:
- `LOGZIO_TRACES_TOKEN` – account token for traces
- `LOGZIO_METRICS_TOKEN` – account token for metrics
- `LOGZIO_LOGS_TOKEN` – account token for logs
- `LOGZIO_REGION` – Logz.io region code (for example, `us`, `eu`)

Optional:
- `OTEL_SERVICE_NAME` – explicit service name
- `OTEL_RESOURCE_ATTRIBUTES` – comma-separated resource attributes (for example, `service.name=my-func,env_id=${LOGZIO_ENV_ID},deployment.environment=${ENVIRONMENT}`)
- `LOGZIO_ENV_ID` – environment identifier you can include in `OTEL_RESOURCE_ATTRIBUTES` (for example, `env_id=prod`)
- `ENVIRONMENT` – logical environment name you can include in `OTEL_RESOURCE_ATTRIBUTES` (for example, `deployment.environment=prod`)

## Sample application

The [sample application](https://github.com/open-telemetry/opentelemetry-lambda/tree/main/go/sample-apps/function/function.go) shows the manual instrumentations of OpenTelemetry Lambda Go SDK on a Lambda handler that triggers downstream requests to AWS S3 and HTTP.
